<template id="messageDialog">
    <style>
    @import 'css/font-awesome.min.css';
    h1 {
        margin: 0;
        margin-bottom: 1em;
        display: inline-block;
        text-align: left;
        font-weight: normal;
        text-align: center;
    }
    .icon {
        font-size: 4em;
        position: relative;
        margin-right: 0.5em;
        top: 0.2em;
    }
    :host[data-type=warn] .icon  {
        color: gold;
    }
    .buttons {
        text-align: center;
    }
    .accept, .cancel {
        margin: 0.5em;
        font-size: 2em;
    }
    .accept {
        color: green;
        cursor: pointer;
    }
    .cancel {
        color: red;
        cursor: pointer;
    }
    </style>
    <span class="icon fa fa-exclamation-circle"></span>
    <h1><content select="h1"></content></h1>
    <p><content select="p"></content></p>
    <div class="buttons">
        <span class="accept fa fa-check"></span>
        <span class="cancel fa fa-close"></span>
    </div>
</template>
<script>
'use strict';
// Record this document.
var importDoc = document.currentScript.ownerDocument;

/* Create a <message-dialog> element type that extends from <dialog>. */
var messageDialogProto = Object.create(HTMLDialogElement.prototype, {

    onClose: {
        value: function(evt) {
            var ret = evt.target.returnValue == 'true';

            evt.target.parentElement.removeChild(evt.target);

            if (evt.target.closeCallback != undefined) {
                evt.target.closeCallback(ret);
            }
        }
    },

    onButtonClick: {
        value: function(evt) {
            /* Call the dialog's close function. */
            evt.currentTarget.parentElement.parentNode.host.close( evt.target.className == 'accept' );
        }
    },

    showModal: {
        /* A type of 'error' or 'info' produces an 'OK'-only dialog box. */
        value: function(type, title, text, closeCallback) {

            this.closeCallback = closeCallback;

            this.getElementsByTagName('h1')[0].textContent = title;
            this.getElementsByTagName('p')[0].textContent = text;


            if (type == 'error' || type == 'info') {
                this.shadowRoot.getElementsByClassName('cancel')[0].classList.toggle('hidden', true);
            }

            HTMLDialogElement.prototype.showModal.call(this);
        }
    },

    createdCallback: {
        value: function() {

            var template = importDoc.querySelector('#messageDialog');
            var clone = document.importNode(template.content, true);
            var root = this.createShadowRoot();
            root.appendChild(clone);

            this.appendChild(document.createElement('h1'));
            this.appendChild(document.createElement('p'));
        }
    },

    attachedCallback: {
        value: function() {
            this.addEventListener('close', this.onClose, false);

            this.shadowRoot.getElementsByClassName('accept')[0].addEventListener('click', this.onButtonClick, false);
            this.shadowRoot.getElementsByClassName('cancel')[0].addEventListener('click', this.onButtonClick, false);
        }
    },

    detachedCallback: {
        value: function() {
            this.removeEventListener('close', this.onClose, false);

            this.shadowRoot.getElementsByClassName('accept')[0].removeEventListener('click', this.onButtonClick, false);
            this.shadowRoot.getElementsByClassName('cancel')[0].removeEventListener('click', this.onButtonClick, false);
        }
    }

});
var MessageDialog = document.registerElement('message-dialog', {
    prototype: messageDialogProto,
    extends: 'dialog'
});
</script>
