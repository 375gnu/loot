<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">

<polymer-element name="loot-plugin-item" attributes="priorityText data">
    <template>
        <style>
        :host(:not([data-bsa])) #loadsBSA,
        :host(:not([data-edits])) #hasUserEdits {
            display: none;
        }
        #loadsBSA > core-icon, #hasUserEdits > core-icon {
            display: block;
            margin-right: 0;
        }
        core-tooltip {
            margin-left: 16px;
        }

        /* paper-item (two-line) */
        paper-item.two-line {
            height: 48px;
        }
        paper-item.two-line::shadow .button-content {
            padding: 7.5px 16px;
        }
        paper-item.two-line .text {
            /* Padding is disabled as otherwise text won't fit in correctly. */
            /*padding: 4px 0;*/
            line-height: normal;
        }
        paper-item.two-line .primary {
            /* MD spec says 16sp, but that doesn't fit, so use 14sp. */
            /*font-size: 1.143rem;*/
            font-size: 1rem;
        }
        paper-item.two-line .secondary {
            /* MD spec says 14sp, but that doesn't fit, so use 12sp. */
            /*font-size: 1rem; */
            font-size: 0.857rem;
            color: rgba(0, 0, 0, 0.54);
        }
        </style>

        <paper-item class="two-line">
            <div class="text" flex>
                <div class="primary"><content select=".name"></content></div>
                <div class="secondary"><content select=".priority"></content></div>
            </div>
            <core-tooltip id="loadsBSA" label="Loads BSA" noarrow position="left">
                <core-icon icon="attachment"></core-icon>
            </core-tooltip>
            <core-tooltip id="hasUserEdits" label="Has User Metadata" noarrow position="left">
                <core-icon icon="account-circle"></core-icon>
            </core-tooltip>
        </paper-item>
    </template>
    <script>
    Polymer({
        data: undefined,

        observe: {
            'data.userlist': 'onUserlistChange'
        },

        dataChanged: function(oldValue, newValue) {
            this.onUserlistChange();
        },

        onUserlistChange: function(oldValue, newValue) {
            /* The enabled key will always be set on application of edits, even
               if there were none to apply, so long for more than just that key. */
            if (this.data && this.data.userlist && Object.keys(this.data.userlist).length > 1) {
                this.setAttribute('data-edits', 'true');
            } else {
                this.removeAttribute('data-edits');
            }
        },

        getName: function() {
            return this.textContent.trim();
        },

        handleDragStart: function(evt) {
            evt.dataTransfer.effectAllowed = 'copy';
            evt.dataTransfer.setData('text/plain', evt.currentTarget.getName());
        },
    });
    </script>
</polymer-element>
