<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="../bower_components/core-icon/core-icon.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="editable-table.html">


<polymer-element name="loot-plugin-card">
    <template>
        <style>
        /* Host and front/editor styling. */
        :host {
            display: block;
            background:white;
            margin:1em;
            position: relative;
            border-top-left-radius: 2px;
            border-top-right-radius: 2px;
            border-bottom-right-radius: 2px;
            border-bottom-left-radius: 2px;
            box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
            position: relative;
            transition: 0.6s;
            transform-style: preserve-3d;
        }
        :host([data-active=false]) .activeTick {
            visibility: hidden;
        }
        :host([data-bsa=false]) .loadsBSA {
            display: none;
        }
        :host([data-dummy=false]) .dummyPlugin {
            display: none;
        }
        :host([data-edits=false]) #hasUserEdits {
            display: none;
        }
        #front {
            padding-bottom: 1em;
        }
        #front, #editor {
            display: block;
        }
        #editor {
            transform: rotateY(180deg) translateZ(1px);
            display:none;
        }

        /* Flip animation styling. */
        :host(.flip) {
            transform: rotateY(180deg);
        }

        :host(.flip) #front  {
            display: none;
        }

        :host(.flip) #editor  {
            display: block;
        }

        /* Icon styling. */
        .activeTick {
            color: green;
        }

        /* Content styling. */
        ::content .tag.add, ::content .tag.remove, ::content ul {
            padding: 0 1em;
        }
        ::content h1, h1 {
            font-weight: normal;
            font-size: 1em;
        }
        ::content .version, .version {
            display: inline-block;
            margin-left: 1em;
            color:#6394F8;
        }
        ::content .crc, .crc {
            display: inline-block;
            margin-left: 1em;
            color:#BC8923;
        }
        ::content .hidden, .hidden {
            display: none;
        }

        /* Editor input styling. */
        #editor > div > paper-checkbox, #editor > div > core-tooltip {
            display: table;
        }
        #enableEdits {
            margin-bottom: 1em;
        }
        #priorityValue {
            margin-left: 0.5em;
        }
        input[readonly] {
            border: none;
            -webkit-user-select: none;
        }
        input:invalid {
            background-color: pink;
            color: white;
        }

        /* Table styling. */
        table {
            margin: 0;
            border-collapse: collapse;
            width: 100%;
        }
        td input {
            width: 100%;
            text-overflow: ellipsis;
        }
        td:last-child {
            cursor: pointer;
        }
        td:last-child:hover {
            color: red;
        }
        td, th {
            vertical-align: top;
            text-align: left;
            padding: 0.5em;
        }
        th {
            border-bottom: 1px black solid;
        }
        tbody tr:last-child {
            cursor: pointer;
            color: grey;
        }
        tbody tr:last-child:hover {
            color: black;
        }

        /* Misc Styling. */
        core-toolbar {
            background: white;
        }
        #buttons {
            text-align: right;
        }
        #editor > div {
            padding: 1em;
        }
        </style>
        <section id="front">
            <core-toolbar>
                <core-tooltip class="activeTick" label="Active">
                    <core-icon icon="check"></core-icon>
                </core-tooltip>
                <content select="h1"></content>
                <content select=".version"></content>
                <span flex><content select=".crc"></content></span>
                <core-tooltip class="dummyPlugin" label="Dummy Plugin">
                    <core-icon icon="visibility-off"></core-icon>
                </core-tooltip>
                <core-tooltip class="loadsBSA" label="Loads BSA">
                    <core-icon icon="attachment"></core-icon>
                </core-tooltip>
                <core-tooltip id="front-hasUserEdits" label="Has User Metadata">
                    <core-icon icon="account-circle"></core-icon>
                </core-tooltip>
                <paper-menu-button icon="more-vert" halign="right">
                    <paper-item>
                        <paper-checkbox id="showOnlyConflicts" label="Show Only Conflicts"></paper-checkbox>
                    </paper-item>
                    <paper-item id="editMetadata" icon="create" label="Edit Metadata"></paper-item>
                    <paper-item id="copyMetadata" icon="content-copy" label="Copy Metadata As Text"></paper-item>
                    <paper-item id="clearMetadata" icon="delete" label="Clear User Metadata"></paper-item>
                </paper-menu-button>
            </core-toolbar>
            <content select=".tag.add"></content>
            <content select=".tag.remove"></content>
            <content select="ul"></content>
        </section>
        <section id="editor">
            <core-toolbar>
                <core-tooltip class="activeTick" label="Active">
                    <core-icon icon="check"></core-icon>
                </core-tooltip>
                <h1></h1>
                <span class="version"></span>
                <span class="crc" flex></span>
                <core-tooltip class="dummyPlugin" label="Dummy Plugin">
                    <core-icon icon="visibility-off"></core-icon>
                </core-tooltip>
                <core-tooltip class="loadsBSA" label="Loads BSA">
                    <core-icon icon="attachment"></core-icon>
                </core-tooltip>
            </core-toolbar>
            <div>
                <paper-checkbox id="enableEdits" label="Enable Edits"></paper-checkbox>
                <core-tooltip label="Global priorities are compared against all other plugins. Normal priorities are compared against only conflicting plugins." position="right">
                    <paper-checkbox id="globalPriority" label="Global Priority"></paper-checkbox>
                </core-tooltip>
                <div horizontal layout center>
                    <div>Priority Value</div>
                    <paper-input type="number" id="priorityValue" max="999999" min="-999999" step="1" value="0" error="Input must be an integer!"></paper-input>
                </div>
                <div id="fileTabs">
                    <paper-tabs selected="loadAfter" valueattr="data-for">
                        <paper-tab data-for="loadAfter">Load After</paper-tab>
                        <paper-tab data-for="req">Requirements</paper-tab>
                        <paper-tab data-for="inc">Incompatibilities</paper-tab>
                    </paper-tabs>
                    <table is="editable-table" id="loadAfter" data-template="fileRow">
                        <thead>
                            <tr><th>Filename</th><th>Display Name</th><th>Condition</th><th></th></tr>
                        </thead>
                        <tbody>
                            <!-- File rows go here. -->
                            <tr><td colspan="4">Add new row...</td><td></td></tr>
                        </tbody>
                    </table>
                    <table is="editable-table" id="req" class="hidden" data-template="fileRow">
                        <thead>
                            <tr><th>Filename</th><th>Display Name</th><th>Condition</th><th></th></tr>
                        </thead>
                        <tbody>
                            <!-- File rows go here. -->
                            <tr><td colspan="4">Add new row...</td><td></td></tr>
                        </tbody>
                    </table>
                    <table is="editable-table" id="inc" class="hidden" data-template="fileRow">
                        <thead>
                            <tr><th>Filename</th><th>Display Name</th><th>Condition</th><th></th></tr>
                        </thead>
                        <tbody>
                            <!-- File rows go here. -->
                            <tr><td colspan="4">Add new row...</td><td></td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="miscTabs">
                    <paper-tabs selected="message" valueattr="data-for">
                        <paper-tab data-for="message">Messages</paper-tab>
                        <paper-tab data-for="tags">Bash Tags</paper-tab>
                        <paper-tab data-for="dirty">Dirty Info</paper-tab>
                        <paper-tab data-for="locations">Locations</paper-tab>
                    </paper-tabs>
                    <table is="editable-table" id="message" data-template="messageRow">
                        <thead>
                            <tr><th>Type</th><th>Content</th><th>Condition</th><th>Language</th><th></th></tr>
                        </thead>
                        <tbody>
                            <!-- Message rows go here. -->
                            <tr><td colspan="4">Add new row...</td><td></td></tr>
                        </tbody>
                    </table>
                    <table is="editable-table" id="tags" class="hidden" data-template="tagRow">
                        <thead>
                            <tr><th>Add/Remove</th><th>Bash Tag</th><th>Condition</th><th></th></tr>
                        </thead>
                        <tbody>
                            <!-- Bash Tag rows go here. -->
                            <tr><td colspan="4">Add new row...</td><td></td></tr>
                        </tbody>
                    </table>
                    <table is="editable-table" id="dirty" class="hidden" data-template="dirtyInfoRow">
                        <thead>
                            <tr><th>CRC</th><th>ITM Count</th><th>Deleted References</th><th>Deleted Navmeshes</th><th>Cleaning Utility</th><th></th></tr>
                        </thead>
                        <tbody>
                            <!-- Dirty info rows go here. -->
                            <tr><td colspan="4">Add new row...</td><td></td></tr>
                        </tbody>
                    </table>
                    <table is="editable-table" id="locations" class="hidden" data-template="locationRow">
                        <thead>
                            <tr><th>URL</th><th>Version</th><th></th></tr>
                        </thead>
                        <tbody>
                            <!-- Location rows go here. -->
                            <tr><td colspan="3">Add new row...</td><td></td></tr>
                        </tbody>
                    </table>
                </div>
                <div id="buttons">
                    <paper-button id="accept">Apply</paper-button>
                    <paper-button id="cancel">Cancel</paper-button>
                </div>
            </div>
        </section>
    </template>
    <script>
    Polymer({
        ready: function() {
            var editor = this.shadowRoot.getElementById('editor');

            editor.querySelector('h1').textContent = this.querySelector('h1').textContent;
            editor.querySelector('.version').textContent = this.querySelector('.version').textContent;
            editor.querySelector('.crc').textContent = this.querySelector('.crc').textContent;
        }
    });
    </script>
</polymer-element>