<!--
<loot-message-dialog> is an extension of <loot-dialog> that provides a
simpler interface for supplying a dialog consisting of a:

* title
* message
* accept button
* cancel button (optional)

It also allows for a callback function to be executed on dialog close.
The function takes one boolean parameter that is true if the accept button
was pressed.
-->

<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="loot-dialog.html">

<polymer-element name="loot-message-dialog">
    <template>
    <style>
    #dialog {
        max-width: 50%;
    }
    </style>
    <loot-dialog id="dialog">
      <content></content>
      <paper-button id="confirm" affirmative autofocus>OK</paper-button>
      <paper-button id="dismiss" dismissive>Cancel</paper-button>
    </loot-dialog>
    </template>
    <script>
    Polymer({
        closeCallback: undefined,

        setConfirmText: function(confirmText) {
          this.shadowRoot.getElementById('confirm').textContent = confirmText;
        },

        setDismissable: function(isDialogDismissable) {
            this.shadowRoot.getElementById('dismiss').hidden = !isDialogDismissable;
        },

        onButtonClick: function(evt) {
            if (evt.target.parentElement.parentNode.host.closeCallback) {
                evt.target.parentElement.parentNode.host.closeCallback(evt.target.id === 'confirm');
            }
            evt.target.parentElement.parentNode.host.addEventListener('core-overlay-close-completed', function(evt){
                evt.target.parentElement.removeChild(evt.target);
            }, false);
        },

        showModal: function(title, text, closeCallback) {
            this.heading = title;
            this.getElementsByClassName('message')[0].textContent = text;

            this.closeCallback = closeCallback;
            this.shadowRoot.getElementById('dialog').showModal();
        },

        created: function() {
            var p = document.createElement('p');
            p.className = 'message';
            this.appendChild(p);
        },

        attached: function() {
            this.shadowRoot.getElementById('confirm').addEventListener('click', this.onButtonClick, false);
            this.shadowRoot.getElementById('dismiss').addEventListener('click', this.onButtonClick, false);
        },

        detached: function() {
            this.shadowRoot.getElementById('confirm').removeEventListener('click', this.onButtonClick, false);
            this.shadowRoot.getElementById('dismiss').removeEventListener('click', this.onButtonClick, false);
        },

    });
    </script>
</polymer-element>
